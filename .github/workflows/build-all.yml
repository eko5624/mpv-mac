name: Build All-in-One-MPV
on:
  #schedule:
  #  - cron: '10 0 * * MON'
    
  workflow_dispatch:

jobs:
  aribb24:
    needs: [libpng]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:    
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/aribb24.sh
        ./scripts/aribb24.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: aribb24*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: aribb24.tar.xz

  brotli:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/brotli.sh
        ./scripts/brotli.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: brotli*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: brotli.tar.xz

  bzip2:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/bzip2.sh
        ./scripts/bzip2.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: bzip2*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: bzip2.tar.xz

  cjson:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/cjson.sh
        ./scripts/cjson.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: cjson*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: cjson.tar.xz

  dav1d:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/dav1d.sh
        ./scripts/dav1d.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: dav1d*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: dav1d.tar.xz

  davs2:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/davs2.sh
        ./scripts/davs2.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: davs2*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: davs2.tar.xz

  expat:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/expat.sh
        ./scripts/expat.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: expat*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: expat.tar.xz

  ffmpeg:
    needs: [aribb24, dav1d, davs2, frei0r, lame, libaribcaption, libass, libbluray, libdvdnav, libbs2b, libcaca, libjxl, libmodplug, libmysofa, libplacebo, librist, libsdl, libssh, libtheora, libvpx, libwebp, libX11, opencore, rubberband, snappy, soxr, speex, srt, svt-av1, uavs3d, x264, x265, xvid, zimg, zvbi]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/aribb24.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/brotli.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/bzip2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/cjson.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/dav1d.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/davs2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/expat.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/flac.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/fontconfig.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/freetype2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/frei0r.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/fribidi.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/giflib.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/harfbuzz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/highway.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lame.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lcms2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libaribcaption.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libass.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libbluray.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libbs2b.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libcaca.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdovi.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdvdcss.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdvdread.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdvdnav.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libjpeg-turbo.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libjxl.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libmodplug.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libmysofa.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libplacebo.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/librist.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libsamplerate.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libsdl.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libsndfile.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libssh.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libtheora.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libtiff.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libunibreak.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libvorbis.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libvpx.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libwebp.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lz4.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/mbedtls.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/mpg123.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/opencore.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/opus.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/rubberband.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/shaderc.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/snappy.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/soxr.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/speex.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/srt.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/svt-av1.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/uavs3d.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/vulkan.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/x264.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/x265.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xvid.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zimg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zstd.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zvbi.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libXau.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libXdmcp.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libxcb.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/util-macros.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xorgproto.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xtrans.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xcb-proto.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/ffmpeg.sh
        ./scripts/ffmpeg.sh
    - name: Collecting logs
      if: always()
      run: |
        mkdir _logs
        cp -fr $(find packages/FFmpeg -type f -name "*.log") _logs || true
        7z a logs.7z _logs
    - name: Uploading logs
      uses: actions/upload-artifact@master
      if: always()
      with:
        name: logs
        path: logs.7z
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: ffmpeg*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: ffmpeg.tar.xz

  flac:
    needs: [libogg]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        tar -xvf libogg.tar.xz -C workspace 2>/dev/null >/dev/null
        chmod +x ./scripts/flac.sh
        ./scripts/flac.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: flac*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: flac.tar.xz

  fontconfig:
    needs: [expat, freetype2]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/bzip2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/expat.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/freetype2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/fontconfig.sh
        ./scripts/fontconfig.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: fontconfig*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: fontconfig.tar.xz
        
  freetype2:
    needs: [bzip2, libpng]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/bzip2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz       
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/freetype2.sh
        ./scripts/freetype2.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: freetype2*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: freetype2.tar.xz

  frei0r:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/frei0r.sh
        ./scripts/frei0r.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: frei0r*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: frei0r.tar.xz

  fribidi:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/fribidi.sh
        ./scripts/fribidi.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: fribidi*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: fribidi.tar.xz

  giflib:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/giflib.sh
        ./scripts/giflib.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: giflib*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: giflib.tar.xz

  harfbuzz:
    needs: [freetype2]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/bzip2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/freetype2.tar.xz 
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz       
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/harfbuzz.sh
        ./scripts/harfbuzz.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: harfbuzz*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: harfbuzz.tar.xz

  highway:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/highway.sh
        ./scripts/highway.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: highway*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: highway.tar.xz

  lame:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/lame.sh
        ./scripts/lame.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: lame*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: lame.tar.xz

  lcms2:
    needs: [libjpeg-turbo, libtiff]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libjpeg-turbo.tar.xz        
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libtiff.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lz4.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xz.tar.xz     
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zstd.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/lcms2.sh
        ./scripts/lcms2.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: lcms2*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: lcms2.tar.xz

  libarchive:
    needs: [bzip2, expat, libb2, lz4, xz, zstd]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/bzip2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/expat.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libb2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lz4.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zstd.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libarchive.sh
        ./scripts/libarchive.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libarchive*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libarchive.tar.xz

  libaribcaption:
    needs: [fontconfig]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/bzip2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/expat.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/fontconfig.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/freetype2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libaribcaption.sh
        ./scripts/libaribcaption.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libaribcaption*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libaribcaption.tar.xz

  libass:
    needs: [freetype2, fribidi, harfbuzz, libunibreak]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/freetype2.tar.xz        
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/fribidi.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/harfbuzz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libunibreak.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libass.sh
        ./scripts/libass.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libass*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libass.tar.xz

  libb2:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libb2.sh
        ./scripts/libb2.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libb2*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libb2.tar.xz
  
  libbluray:
    needs: [fontconfig]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/bzip2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/expat.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/fontconfig.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/freetype2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libbluray.sh
        ./scripts/libbluray.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libbluray*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libbluray.tar.xz

  libbs2b:
    needs: [libsndfile]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libsndfile.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/flac.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lame.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libvorbis.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/mpg123.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/opus.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libbs2b.sh
        ./scripts/libbs2b.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libbs2b*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libbs2b.tar.xz

  libcaca:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libcaca.sh
        ./scripts/libcaca.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libcaca*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libcaca.tar.xz

  libdovi:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libdovi.sh
        ./scripts/libdovi.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libdovi*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libdovi.tar.xz

  libdvdcss:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer
    - name: Build
      run: |
        chmod +x ./scripts/libdvdcss.sh
        ./scripts/libdvdcss.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libdvdcss*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libdvdcss.tar.xz

  libdvdread:
    needs: [libdvdcss]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdvdcss.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libdvdread.sh
        ./scripts/libdvdread.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libdvdread*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libdvdread.tar.xz

  libdvdnav:
    needs: [libdvdread]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdvdcss.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdvdread.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libdvdnav.sh
        ./scripts/libdvdnav.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libdvdnav*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libdvdnav.tar.xz

  libjpeg-turbo:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libjpeg-turbo.sh
        ./scripts/libjpeg-turbo.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libjpeg-turbo*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libjpeg-turbo.tar.xz

  libjxl:
    needs: [brotli, giflib, highway, libjpeg-turbo, libpng, lcms2]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/brotli.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/giflib.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/highway.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libjpeg-turbo.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libtiff.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lcms2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lz4.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zstd.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libjxl.sh
        ./scripts/libjxl.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libjxl*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libjxl.tar.xz

  libmodplug:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libmodplug.sh
        ./scripts/libmodplug.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libmodplug*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libmodplug.tar.xz

  libmysofa:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libmysofa.sh
        ./scripts/libmysofa.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libmysofa*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libmysofa.tar.xz

  libogg:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libogg.sh
        ./scripts/libogg.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libogg*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libogg.tar.xz

  libplacebo:
    needs: [lcms2, shaderc, vulkan]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lcms2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdovi.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libjpeg-turbo.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libtiff.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lz4.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/shaderc.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/vulkan.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zstd.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libplacebo.sh
        ./scripts/libplacebo.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libplacebo*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libplacebo.tar.xz

  libpng:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libpng.sh
        ./scripts/libpng.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libpng*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libpng.tar.xz

  librist:
    needs: [cjson, mbedtls]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/cjson.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/mbedtls.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/librist.sh
        ./scripts/librist.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: librist*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: librist.tar.xz

  libsamplerate:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libsamplerate.sh
        ./scripts/libsamplerate.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libsamplerate*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libsamplerate.tar.xz

  libsdl:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libsdl.sh
        ./scripts/libsdl.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libsdl*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libsdl.tar.xz

  libsndfile:
    needs: [flac, lame, libogg, libvorbis, mpg123, opus]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/flac.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lame.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libvorbis.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/mpg123.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/opus.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libsndfile.sh
        ./scripts/libsndfile.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libsndfile*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libsndfile.tar.xz

  libssh:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libssh.sh
        ./scripts/libssh.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libssh*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libssh.tar.xz

  libtheora:
    needs: [libogg, libvorbis]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libvorbis.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libtheora.sh
        ./scripts/libtheora.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libtheora*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libtheora.tar.xz

  libtiff:
    needs: [libjpeg-turbo, xz, zstd]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libjpeg-turbo.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lz4.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zstd.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libtiff.sh
        ./scripts/libtiff.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libtiff*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libtiff.tar.xz

  libunibreak:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libunibreak.sh
        ./scripts/libunibreak.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libunibreak*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libunibreak.tar.xz

  libvorbis:
    needs: [libogg]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        tar xvf libogg.tar.xz -C workspace 2>/dev/null >/dev/null
        chmod +x ./scripts/libvorbis.sh
        ./scripts/libvorbis.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libvorbis*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libvorbis.tar.xz

  libvpx:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/libvpx.sh
        ./scripts/libvpx.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libvpx*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libvpx.tar.xz

  libwebp:
    needs: [giflib, libjpeg-turbo, libpng, libtiff]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/giflib.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libjpeg-turbo.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libtiff.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lz4.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zstd.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libwebp.sh
        ./scripts/libwebp.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libwebp*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libwebp.tar.xz

  libX11:
    needs: [util-macros, xtrans, libxcb, xorgproto]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libXau.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libXdmcp.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libxcb.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/util-macros.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xorgproto.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xtrans.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xcb-proto.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libX11.sh
        ./scripts/libX11.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libX11*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libX11.tar.xz

  libXau:
    needs: [util-macros, xorgproto]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/util-macros.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xorgproto.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libXau.sh
        ./scripts/libXau.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libXau*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libXau.tar.xz

  libxcb:
    needs: [libXau, libXdmcp, xcb-proto]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libXau.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libXdmcp.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/util-macros.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xorgproto.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xcb-proto.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libxcb.sh
        ./scripts/libxcb.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libxcb*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libxcb.tar.xz

  libXdmcp:
    needs: [xorgproto]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/util-macros.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xorgproto.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/libXdmcp.sh
        ./scripts/libXdmcp.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: libXdmcp*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: libXdmcp.tar.xz

  luajit:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/luajit.sh
        ./scripts/luajit.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: luajit*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: luajit.tar.xz

  lz4:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/lz4.sh
        ./scripts/lz4.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: lz4*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: lz4.tar.xz

  mbedtls:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/mbedtls.sh
        ./scripts/mbedtls.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: mbedtls*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: mbedtls.tar.xz

  molten-vk:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/molten-vk.sh
        ./scripts/molten-vk.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: molten-vk*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: molten-vk.tar.xz
        
  mpg123:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/mpg123.sh
        ./scripts/mpg123.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: mpg123*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: mpg123.tar.xz

  mpv:
    needs: [ffmpeg, libarchive, luajit, molten-vk, mujs, uchardet]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/aribb24.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/brotli.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/bzip2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/cjson.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/dav1d.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/davs2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/expat.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/flac.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/fontconfig.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/freetype2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/frei0r.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/fribidi.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/giflib.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/harfbuzz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/highway.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lame.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lcms2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libaribcaption.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libass.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libbluray.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libbs2b.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libcaca.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdovi.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdvdcss.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdvdread.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libdvdnav.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libjpeg-turbo.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libjxl.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libmodplug.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libmysofa.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libplacebo.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/librist.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libsamplerate.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libsdl.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libsndfile.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libssh.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libtheora.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libtiff.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libunibreak.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libvorbis.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libvpx.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libwebp.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lz4.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/mbedtls.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/mpg123.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/opencore.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/opus.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/rubberband.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/shaderc.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/snappy.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/soxr.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/speex.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/srt.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/svt-av1.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/uavs3d.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/vulkan.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/x264.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/x265.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xvid.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xz.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zimg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zstd.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/zvbi.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libXau.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libXdmcp.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libxcb.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/util-macros.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xorgproto.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xtrans.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xcb-proto.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/ffmpeg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libarchive.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libb2.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/luajit.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/molten-vk.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/mujs.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/uchardet.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/mpv.sh
        ./scripts/mpv.sh
    - name: Get current timestamp
      run: echo "date=$(date +%Y-%m-%d)" >> $GITHUB_ENV        
    - name: Zip mpv.app
      run: |
        mkdir All-in-One
        curl -OL https://github.com/eko5624/mpv-config/archive/refs/heads/main.zip
        unzip main.zip
        mv mpv-config-main/macos_config All-in-One
        mv packages/mpv/build/mpv.app All-in-One
        mv packages/mpv/build/SHORT_SHA All-in-One
        zip -r -y All-in-One-${{ env.date }}.zip All-in-One/*
    - name: Get mpv short sha
      run: |
        echo "sha=$(cat packages/mpv/build/SHORT_SHA)" >> $GITHUB_ENV
    - name: "Generate release note"
      id: note
      uses: actions/github-script@v7
      with:
        script: |
          const sha = `${{ env.sha }}`;
          let note = `Bump to mpv-player/mpv@${sha}\n`;
          note+="**System Requirements**: macOS 11 or later\n";
          note+="**Add vulkan support by setting**: `vo=gpu gpu-context=macvk`";
          core.setOutput("note", note);
    - name: Create Release
      uses: softprops/action-gh-release@master
      with:
        tag_name: ${{ env.date }}
        name: ${{ env.date }}
        body: ${{ steps.note.outputs.note }}
        files: All*.zip

  mujs:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/mujs.sh
        ./scripts/mujs.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: mujs*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: mujs.tar.xz

  opencore:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/opencore.sh
        ./scripts/opencore.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: opencore*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: opencore.tar.xz

  opus:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/opus.sh
        ./scripts/opus.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: opus*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: opus.tar.xz

  rubberband:
    needs: [libsamplerate, libsndfile]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/flac.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lame.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libsndfile.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libvorbis.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/mpg123.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/opus.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libsamplerate.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/rubberband.sh
        ./scripts/rubberband.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: rubberband*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: rubberband.tar.xz

  shaderc:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/shaderc.sh
        ./scripts/shaderc.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: shaderc*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: shaderc.tar.xz

  snappy:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/snappy.sh
        ./scripts/snappy.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: snappy*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: snappy.tar.xz

  soxr:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/soxr.sh
        ./scripts/soxr.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: soxr*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: soxr.tar.xz

  speex:
    needs: [libogg]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libogg.tar.xz
        tar xvf libogg.tar.xz -C workspace 2>/dev/null >/dev/null
        chmod +x ./scripts/speex.sh
        ./scripts/speex.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: speex*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: speex.tar.xz

  srt:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/srt.sh
        ./scripts/srt.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: srt*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: srt.tar.xz

  svt-av1:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/svt-av1.sh
        ./scripts/svt-av1.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: svt-av1*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: svt-av1.tar.xz

  uavs3d:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/uavs3d.sh
        ./scripts/uavs3d.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: uavs3d*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: uavs3d.tar.xz

  uchardet:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/uchardet.sh
        ./scripts/uchardet.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: uchardet*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: uchardet.tar.xz

  util-macros:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/util-macros.sh
        ./scripts/util-macros.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: util-macros*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: util-macros.tar.xz

  vulkan:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/vulkan.sh
        ./scripts/vulkan.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: vulkan*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: vulkan.tar.xz

  x264:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/x264.sh
        ./scripts/x264.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: x264*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: x264.tar.xz

  x265:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/x265.sh
        ./scripts/x265.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: x265*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: x265.tar.xz

  xcb-proto:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/xcb-proto.sh
        ./scripts/xcb-proto.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: xcb-proto*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: xcb-proto.tar.xz

  xorgproto:
    needs: [util-macros]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/util-macros.tar.xz
        tar xvf util-macros.tar.xz -C workspace 2>/dev/null >/dev/null
        chmod +x ./scripts/xorgproto.sh
        ./scripts/xorgproto.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: xorgproto*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: xorgproto.tar.xz

  xtrans:
    needs: [util-macros, xorgproto]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/util-macros.tar.xz
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xorgproto.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/xtrans.sh
        ./scripts/xtrans.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: xtrans*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: xtrans.tar.xz

  xvid:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/xvid.sh
        ./scripts/xvid.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: xvid*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: xvid.tar.xz

  xz:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/xz.sh
        ./scripts/xz.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: xz*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: xz.tar.xz

  zimg:
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        chmod +x ./scripts/zimg.sh
        ./scripts/zimg.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: zimg*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: zimg.tar.xz

  zstd:
    needs: [lz4, xz]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/lz4.tar.xz        
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/xz.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/zstd.sh
        ./scripts/zstd.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: zstd*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: zstd.tar.xz

  zvbi:
    needs: [libpng]
    runs-on: ${{ matrix.os }}
    env:
      ARCHS: ${{ matrix.arch }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    strategy:
      matrix:
        os:
          - "macos-13"
          - "macos-14"
        include:
          - os: "macos-13"
            arch: "x86_64"
          - os: "macos-14"
            arch: "arm64"
    steps:   
    - name: Checkout
      uses: actions/checkout@main
    - name: Loading tools cache
      uses: actions/cache/restore@main
      with:
        path: ${{ github.workspace }}/workspace
        key: tools-${{ matrix.arch }}-${{ github.run_id }}
        restore-keys: tools-${{ matrix.arch }}-
    - name: Switch to Xcode 15.2
      run: |
        sudo xcode-select --reset
        sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer  
    - name: Build
      run: |
        curl -OL https://github.com/${{ github.repository }}/releases/download/dev/libpng.tar.xz
        for f in *.xz; do tar xvf "$f" -C workspace 2>/dev/null >/dev/null; done
        chmod +x ./scripts/zvbi.sh
        ./scripts/zvbi.sh
    - name: Delete
      uses: mknejp/delete-release-assets@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag: dev-${{ matrix.arch }}
        assets: zvbi*.xz
        fail-if-no-assets: false
        fail-if-no-release: false
    - name: Upload
      continue-on-error: true
      uses: softprops/action-gh-release@master
      with:
        tag_name: dev-${{ matrix.arch }}
        name: dev-${{ matrix.arch }}
        files: zvbi.tar.xz
